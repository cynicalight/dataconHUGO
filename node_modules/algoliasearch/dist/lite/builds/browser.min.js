function $(r,e,o="WithinHeaders"){let t={"x-algolia-api-key":e,"x-algolia-application-id":r};return{headers(){return o==="WithinHeaders"?t:{}},queryParameters(){return o==="WithinQueryParameters"?t:{}}}}function k(r){let e,o=`algolia-client-js-${r.key}`;function t(){return e===void 0&&(e=r.localStorage||window.localStorage),e}function s(){return JSON.parse(t().getItem(o)||"{}")}function l(a){t().setItem(o,JSON.stringify(a))}function i(){let a=r.timeToLive?r.timeToLive*1e3:null,n=s(),f=Object.fromEntries(Object.entries(n).filter(([,g])=>g.timestamp!==void 0));if(l(f),!a)return;let p=Object.fromEntries(Object.entries(f).filter(([,g])=>{let c=new Date().getTime();return!(g.timestamp+a<c)}));l(p)}return{get(a,n,f={miss:()=>Promise.resolve()}){return Promise.resolve().then(()=>(i(),s()[JSON.stringify(a)])).then(p=>Promise.all([p?p.value:n(),p!==void 0])).then(([p,g])=>Promise.all([p,g||f.miss(p)])).then(([p])=>p)},set(a,n){return Promise.resolve().then(()=>{let f=s();return f[JSON.stringify(a)]={timestamp:new Date().getTime(),value:n},t().setItem(o,JSON.stringify(f)),n})},delete(a){return Promise.resolve().then(()=>{let n=s();delete n[JSON.stringify(a)],t().setItem(o,JSON.stringify(n))})},clear(){return Promise.resolve().then(()=>{t().removeItem(o)})}}}function Y(){return{get(r,e,o={miss:()=>Promise.resolve()}){return e().then(s=>Promise.all([s,o.miss(s)])).then(([s])=>s)},set(r,e){return Promise.resolve(e)},delete(r){return Promise.resolve()},clear(){return Promise.resolve()}}}function E(r){let e=[...r.caches],o=e.shift();return o===void 0?Y():{get(t,s,l={miss:()=>Promise.resolve()}){return o.get(t,s,l).catch(()=>E({caches:e}).get(t,s,l))},set(t,s){return o.set(t,s).catch(()=>E({caches:e}).set(t,s))},delete(t){return o.delete(t).catch(()=>E({caches:e}).delete(t))},clear(){return o.clear().catch(()=>E({caches:e}).clear())}}}function w(r={serializable:!0}){let e={};return{get(o,t,s={miss:()=>Promise.resolve()}){let l=JSON.stringify(o);if(l in e)return Promise.resolve(r.serializable?JSON.parse(e[l]):e[l]);let i=t();return i.then(a=>s.miss(a)).then(()=>i)},set(o,t){return e[JSON.stringify(o)]=r.serializable?JSON.stringify(t):t,Promise.resolve(t)},delete(o){return delete e[JSON.stringify(o)],Promise.resolve()},clear(){return e={},Promise.resolve()}}}var F=2*60*1e3;function W(r,e="up"){let o=Date.now();function t(){return e==="up"||Date.now()-o>F}function s(){return e==="timed out"&&Date.now()-o<=F}return{...r,status:e,lastUpdate:o,isUp:t,isTimedOut:s}}var M=class extends Error{name="AlgoliaError";constructor(r,e){super(r),e&&(this.name=e)}},H=class extends M{stackTrace;constructor(r,e,o){super(r,o),this.stackTrace=e}},Z=class extends H{constructor(r){super("Unreachable hosts - your application id may be incorrect. If the error persists, please reach out to the Algolia Support team: https://alg.li/support.",r,"RetryError")}},C=class extends H{status;constructor(r,e,o,t="ApiError"){super(r,o,t),this.status=e}},ee=class extends M{response;constructor(r,e){super(r,"DeserializationError"),this.response=e}},re=class extends C{error;constructor(r,e,o,t){super(r,e,t,"DetailedApiError"),this.error=o}};function I(r){let e=r;for(let o=r.length-1;o>0;o--){let t=Math.floor(Math.random()*(o+1)),s=r[o];e[o]=r[t],e[t]=s}return e}function te(r,e,o){let t=oe(o),s=`${r.protocol}://${r.url}${r.port?`:${r.port}`:""}/${e.charAt(0)==="/"?e.substring(1):e}`;return t.length&&(s+=`?${t}`),s}function oe(r){return Object.keys(r).filter(e=>r[e]!==void 0).sort().map(e=>`${e}=${encodeURIComponent(Object.prototype.toString.call(r[e])==="[object Array]"?r[e].join(","):r[e]).replaceAll("+","%20")}`).join("&")}function ae(r,e){if(r.method==="GET"||r.data===void 0&&e.data===void 0)return;let o=Array.isArray(r.data)?r.data:{...r.data,...e.data};return JSON.stringify(o)}function se(r,e,o){let t={Accept:"application/json",...r,...e,...o},s={};return Object.keys(t).forEach(l=>{let i=t[l];s[l.toLowerCase()]=i}),s}function ne(r){try{return JSON.parse(r.content)}catch(e){throw new ee(e.message,r)}}function ie({content:r,status:e},o){try{let t=JSON.parse(r);return"error"in t?new re(t.message,e,t.error,o):new C(t.message,e,o)}catch{}return new C(r,e,o)}function ce({isTimedOut:r,status:e}){return!r&&~~e===0}function me({isTimedOut:r,status:e}){return r||ce({isTimedOut:r,status:e})||~~(e/100)!==2&&~~(e/100)!==4}function le({status:r}){return~~(r/100)===2}function ue(r){return r.map(e=>j(e))}function j(r){let e=r.request.headers["x-algolia-api-key"]?{"x-algolia-api-key":"*****"}:{};return{...r,request:{...r.request,headers:{...r.request.headers,...e}}}}function J({hosts:r,hostsCache:e,baseHeaders:o,baseQueryParameters:t,algoliaAgent:s,timeouts:l,requester:i,requestsCache:a,responsesCache:n}){async function f(c){let m=await Promise.all(c.map(u=>e.get(u,()=>Promise.resolve(W(u))))),x=m.filter(u=>u.isUp()),d=m.filter(u=>u.isTimedOut()),R=[...x,...d];return{hosts:R.length>0?R:c,getTimeout(u,P){return(d.length===0&&u===0?1:d.length+3+u)*P}}}async function p(c,m,x=!0){let d=[],R=ae(c,m),y=se(o,c.headers,m.headers),u=c.method==="GET"?{...c.data,...m.data}:{},P={...t,...c.queryParameters,...u};if(s.value&&(P["x-algolia-agent"]=s.value),m&&m.queryParameters)for(let h of Object.keys(m.queryParameters))!m.queryParameters[h]||Object.prototype.toString.call(m.queryParameters[h])==="[object Object]"?P[h]=m.queryParameters[h]:P[h]=m.queryParameters[h].toString();let v=0,N=async(h,O)=>{let S=h.pop();if(S===void 0)throw new Z(ue(d));let b={...l,...m.timeouts},L={data:R,headers:y,method:c.method,url:te(S,c.path,P),connectTimeout:O(v,b.connect),responseTimeout:O(v,x?b.read:b.write)},D=q=>{let U={request:L,response:q,host:S,triesLeft:h.length};return d.push(U),U},T=await i.send(L);if(me(T)){let q=D(T);return T.isTimedOut&&v++,console.log("Retryable failure",j(q)),await e.set(S,W(S,T.isTimedOut?"timed out":"down")),N(h,O)}if(le(T))return ne(T);throw D(T),ie(T,d)},K=r.filter(h=>h.accept==="readWrite"||(x?h.accept==="read":h.accept==="write")),_=await f(K);return N([..._.hosts].reverse(),_.getTimeout)}function g(c,m={}){let x=c.useReadTransporter||c.method==="GET";if(!x)return p(c,m,x);let d=()=>p(c,m);if((m.cacheable||c.cacheable)!==!0)return d();let y={request:c,requestOptions:m,transporter:{queryParameters:t,headers:o}};return n.get(y,()=>a.get(y,()=>a.set(y,d()).then(u=>Promise.all([a.delete(y),u]),u=>Promise.all([a.delete(y),Promise.reject(u)])).then(([u,P])=>P)),{miss:u=>n.set(y,u)})}return{hostsCache:e,requester:i,timeouts:l,algoliaAgent:s,baseHeaders:o,baseQueryParameters:t,hosts:r,request:g,requestsCache:a,responsesCache:n}}function pe(r){let e={value:`Algolia for JavaScript (${r})`,add(o){let t=`; ${o.segment}${o.version!==void 0?` (${o.version})`:""}`;return e.value.indexOf(t)===-1&&(e.value=`${e.value}${t}`),e}};return e}function z({algoliaAgents:r,client:e,version:o}){let t=pe(o).add({segment:e,version:o});return r.forEach(s=>t.add(s)),t}var G=1e3,Q=2e3,B=3e4;function V(){function r(e){return new Promise(o=>{let t=new XMLHttpRequest;t.open(e.method,e.url,!0),Object.keys(e.headers).forEach(a=>t.setRequestHeader(a,e.headers[a]));let s=(a,n)=>setTimeout(()=>{t.abort(),o({status:0,content:n,isTimedOut:!0})},a),l=s(e.connectTimeout,"Connection timeout"),i;t.onreadystatechange=()=>{t.readyState>t.OPENED&&i===void 0&&(clearTimeout(l),i=s(e.responseTimeout,"Socket timeout"))},t.onerror=()=>{t.status===0&&(clearTimeout(l),clearTimeout(i),o({content:t.responseText||"Network request failed",status:t.status,isTimedOut:!1}))},t.onload=()=>{clearTimeout(l),clearTimeout(i),o({content:t.responseText,status:t.status,isTimedOut:!1})},t.send(e.data)})}return{send:r}}var A="5.4.1";function fe(r){return[{url:`${r}-dsn.algolia.net`,accept:"read",protocol:"https"},{url:`${r}.algolia.net`,accept:"write",protocol:"https"}].concat(I([{url:`${r}-1.algolianet.com`,accept:"readWrite",protocol:"https"},{url:`${r}-2.algolianet.com`,accept:"readWrite",protocol:"https"},{url:`${r}-3.algolianet.com`,accept:"readWrite",protocol:"https"}]))}function X({appId:r,apiKey:e,authMode:o,algoliaAgents:t,...s}){let l=$(r,e,o),i=J({hosts:fe(r),...s,algoliaAgent:z({algoliaAgents:t,client:"Lite",version:A}),baseHeaders:{"content-type":"text/plain",...l.headers(),...s.baseHeaders},baseQueryParameters:{...l.queryParameters(),...s.baseQueryParameters}});return{transporter:i,appId:r,clearCache(){return Promise.all([i.requestsCache.clear(),i.responsesCache.clear()]).then(()=>{})},get _ua(){return i.algoliaAgent.value},addAlgoliaAgent(a,n){i.algoliaAgent.add({segment:a,version:n})},setClientApiKey({apiKey:a}){!o||o==="WithinHeaders"?i.baseHeaders["x-algolia-api-key"]=a:i.baseQueryParameters["x-algolia-api-key"]=a},searchForHits(a,n){return this.search(a,n)},searchForFacets(a,n){return this.search(a,n)},customPost({path:a,parameters:n,body:f},p){if(!a)throw new Error("Parameter `path` is required when calling `customPost`.");let x={method:"POST",path:"/{path}".replace("{path}",a),queryParameters:n||{},headers:{},data:f||{}};return i.request(x,p)},getRecommendations(a,n){if(a&&Array.isArray(a)&&(a={requests:a}),!a)throw new Error("Parameter `getRecommendationsParams` is required when calling `getRecommendations`.");if(!a.requests)throw new Error("Parameter `getRecommendationsParams.requests` is required when calling `getRecommendations`.");let c={method:"POST",path:"/1/indexes/*/recommendations",queryParameters:{},headers:{},data:a,useReadTransporter:!0,cacheable:!0};return i.request(c,n)},search(a,n){if(a&&Array.isArray(a)&&(a={requests:a.map(({params:x,...d})=>d.type==="facet"?{...d,...x,type:"facet"}:{...d,...x,facet:void 0,maxFacetHits:void 0,facetQuery:void 0})}),!a)throw new Error("Parameter `searchMethodParams` is required when calling `search`.");if(!a.requests)throw new Error("Parameter `searchMethodParams.requests` is required when calling `search`.");let c={method:"POST",path:"/1/indexes/*/queries",queryParameters:{},headers:{},data:a,useReadTransporter:!0,cacheable:!0};return i.request(c,n)}}}function Ut(r,e,o){if(!r||typeof r!="string")throw new Error("`appId` is missing.");if(!e||typeof e!="string")throw new Error("`apiKey` is missing.");return X({appId:r,apiKey:e,timeouts:{connect:G,read:Q,write:B},requester:V(),algoliaAgents:[{segment:"Browser"}],authMode:"WithinQueryParameters",responsesCache:w(),requestsCache:w({serializable:!1}),hostsCache:E({caches:[k({key:`${A}-${r}`}),w()]}),...o})}export{A as apiClientVersion,Ut as liteClient};
//# sourceMappingURL=browser.min.js.map